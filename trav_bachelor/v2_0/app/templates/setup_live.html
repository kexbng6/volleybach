<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Live - Volleyball Scoreboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">
    {% include 'nav.html' %}
    <div class="container py-4">
        <div class="live-setup-container">
            <h1 class="live-setup-title">Configuration du Live Match</h1>

            <div class="team-selection">
                <div class="teams-container">
                    <div class="team-block">
                        <h3>Équipe A</h3>
                        <select id="team-a-select" class="team-select"></select>
                    </div>

                    <div class="team-block">
                        <h3>Équipe B</h3>
                        <select id="team-b-select" class="team-select"></select>
                    </div>
                </div>

                <button id="load-to-vmix" class="load-vmix-btn">Charger dans vMix</button>

                <div id="status-message" class="status-message" style="display: none;"></div>
            </div>

            <div class="control-section">
                <h3>Contrôle de la miniature</h3>
                <div class="switch-container">
                <input type="file" id="thumbnailUpload" accept="image/*" style="display: none;">
                    <label class="switch">
                        <input type="checkbox" id="thumbnailSwitch">
                        <span class="slider round"></span>
                    </label>
                    <span class="switch-label">Afficher la miniature du match</span>
                </div>
            </div>


        </div>

    </div>

    <script>
        $(document).ready(function() {
            // Charger la liste des équipes
            $.get('/team/teams', function(teams) {
                teams.forEach(team => {
                    $('#team-a-select, #team-b-select').append(
                        $('<option></option>').val(team.id).text(team.name)
                    );
                });
            });

            // Gérer le chargement vers vMix
            $('#load-to-vmix').click(function() {
                const teamAId = $('#team-a-select').val();
                const teamBId = $('#team-b-select').val();

                $.post('/api/vmix/load-teams', {
                    teamA: teamAId,
                    teamB: teamBId
                })
                .done(function(response) {
                    showStatus('Équipes chargées avec succès', 'success');
                })
                .fail(function(error) {
                    showStatus('Erreur lors du chargement des équipes: ' + error.responseText, 'error');
                });
            });

            // Gestion du switch de la miniature
            $('#thumbnailSwitch').change(function() {
                const isChecked = $(this).is(':checked');

                $.post('/api/vmix/toggle-thumbnail', {
                    show: isChecked
                })
                .done(function(response) {
                    showStatus(`Miniature ${isChecked ? 'affichée' : 'masquée'}`, 'success');
                })
                .fail(function(error) {
                    showStatus('Erreur lors du changement de la miniature', 'error');
                    // Remettre le switch dans son état précédent en cas d'erreur
                    $(this).prop('checked', !isChecked);
                });
            });

            // Fonction pour afficher les messages de statut
            function showStatus(message, type) {
                const statusDiv = $('#status-message');
                statusDiv
                    .removeClass('status-success status-error')
                    .addClass('status-' + type)
                    .text(message)
                    .show()
                    .delay(3000)
                    .fadeOut();
            }
        });
    </script>
</body>
</html>